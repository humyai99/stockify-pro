<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockify Pro AI ü§ñ</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Outfit:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">
        <header>
            <h1 data-i18n="analyzer_title">Stockify Pro ü§ñ</h1>
            <div class="subtitle" data-i18n="analyzer_sub">AI-Powered Technical Analysis Assistant</div>
        </header>



        <div class="nav-bar">
            <a href="index.html" class="nav-link active" data-i18n="nav_analyzer">üìä Analyzer</a>
            <a href="screener.html" class="nav-link" data-i18n="nav_screener">üîç Screener</a>
            <a href="compare.html" class="nav-link" data-i18n="nav_compare">‚öñÔ∏è Compare</a>
            <a href="advanced.html" class="nav-link" data-i18n="nav_advanced">üß† Advanced</a>
            <a href="insider.html" class="nav-link" data-i18n="nav_insider">üëî Insider</a>
            <a href="darkpool.html" class="nav-link" data-i18n="nav_darkpool">üåä Dark Pool</a>
            <a href="earnings.html" class="nav-link" data-i18n="nav_earnings">üìÖ Earnings</a>
            <a href="calendar.html" class="nav-link" data-i18n="nav_calendar">üìÜ Calendar</a>
            <a href="sectors.html" class="nav-link" data-i18n="nav_sectors">üîÑ Sectors</a>
            <a href="heatmap.html" class="nav-link" data-i18n="nav_heatmap">üó∫Ô∏è Heatmap</a>
            <a href="volatility.html" class="nav-link" data-i18n="nav_volatility">‚ö° Volatility</a>
            <a href="portfolio.html" class="nav-link" data-i18n="nav_portfolio">üíº Portfolio</a>
        </div>

        <div class="card">
            <div class="search-container">
                <form id="search-form" class="search-box">
                    <input type="text" id="symbol-input" list="stock-list" data-i18n="search_placeholder"
                        placeholder="üîç Search Symbol (e.g. AAPL, PTT.BK)" required>
                    <datalist id="stock-list"></datalist>
                    <button type="submit" data-i18n="btn_analyze">Analyze</button>
                </form>
                <div class="search-tips">
                    <span data-i18n="search_tips">üí° Tips: Type <strong>any</strong> symbol! (e.g., AAPL, 7203.T,
                        0700.HK, BTC-USD). Use <strong>.BK</strong> for Thai stocks.</span>
                </div>
            </div>

            <!-- Favorites Panel (New) -->
            <div id="favorites-section" style="margin-top: 1rem; display: none;">
                <h3 style="margin-bottom: 0.5rem;" data-i18n="favorites">Favorites ‚≠ê</h3>
                <div id="fav-grid" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- Discovery Dashboard (New) -->
            <div id="discovery-section" style="margin-top: 2rem; display: none;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    üß≠ AI Market Discovery <span
                        style="font-size: 0.8rem; font-weight: normal; color: var(--text-secondary);">(Top
                        Opportunities)</span>
                </h3>
                <div id="discovery-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    <!-- Cards will be injected here -->
                    <div style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">
                        Scanning Markets... üì°
                    </div>
                </div>
            </div>
        </div>

        <div id="loading-spinner" class="spinner" style="display: none;">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>

        <!-- Trading Panel (New) -->
        <div id="trading-panel" class="card"
            style="display: none; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-color);">
            <div class="trading-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin:0;">üíº Paper Trading</h3>
                <div class="balance-display">
                    üíµ Balance: <span id="wallet-balance" style="font-weight:bold; color:#22c55e;">0.00</span>
                </div>
            </div>

            <div class="trade-controls" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div class="form-group" style="flex: 1;">
                    <label>Action</label>
                    <select id="trade-action">
                        <option value="BUY">üü¢ BUY (Long)</option>
                        <option value="SELL">üî¥ SELL (Short/Close)</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Quantity</label>
                    <input type="number" id="trade-qty" value="100" min="1">
                </div>
                <button id="btn-execute-trade" class="btn-primary" style="flex: 1; margin: 0; padding: 0.75rem;">
                    Submit Order üöÄ
                </button>
            </div>
            <div id="trade-feedback" style="margin-top: 1rem; text-align: center; font-weight: bold;"></div>
        </div>



        <!-- Chart & Fundamentals Section (Tabbed) -->
        <div id="chart-card" class="card" style="display: none; padding: 0; position: relative;">
            <div class="tabs"
                style="display:flex; border-bottom:1px solid var(--glass-border); padding: 0.5rem 1rem 0 1rem; gap:1rem; align-items:center;">
                <button class="tab-btn active" onclick="switchTab('chart')"
                    style="background:none; border:none; color:white; padding:0.5rem; border-bottom:2px solid var(--accent-color); cursor:pointer;">Price
                    Chart</button>
                <button class="tab-btn" onclick="switchTab('fund')"
                    style="background:none; border:none; color:var(--text-secondary); padding:0.5rem; cursor:pointer;"
                    data-i18n="fund_title">Fundamental Radar</button>

                <button class="tab-btn" onclick="switchTab('tech')"
                    style="background:none; border:none; color:var(--text-secondary); padding:0.5rem; cursor:pointer;"
                    data-i18n="tech_title">Technical Scorecard üìù</button>

                <!-- Backtest Button (Moved Here) -->
                <button id="btn-run-backtest" class="btn-primary"
                    style="margin-left:auto; padding: 0.3rem 0.8rem; font-size: 0.8rem; background: rgba(30, 41, 59, 0.8); border: 1px solid var(--border-color);">
                    Run Backtest üîô
                </button>
            </div>

            <!-- Backtest Overlay (Moved Here) -->
            <div id="backtest-overlay"
                style="display: none; position: absolute; top: 4rem; right: 1rem; background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent-color); padding: 1rem; border-radius: 8px; z-index: 20; width: 250px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <h4 style="margin: 0 0 0.5rem 0; color: var(--accent-color);">Backtest (1 Year)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
                    <div style="color: var(--text-secondary);">Return:</div>
                    <div id="bt-return" style="font-weight: bold;">...</div>
                    <div style="color: var(--text-secondary);">Win Rate:</div>
                    <div id="bt-winrate" style="font-weight: bold;">...</div>
                    <div style="color: var(--text-secondary);">Trades:</div>
                    <div id="bt-trades" style="font-weight: bold;">...</div>
                </div>
            </div>

            <div id="chart-container" style="height: 450px; width: 100%;"></div>

            <div id="fundamentals-view" style="display:none; padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Radar/Score (Visual) -->
                    <div class="card"
                        style="background: rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; border: 1px solid var(--glass-border);">
                        <div id="fair-value-box" style="text-align: center;">
                            <div data-i18n="fund_fair_value"
                                style="color:var(--text-secondary); margin-bottom: 0.5rem; font-size:1.1rem;">Fair Value
                            </div>
                            <div id="val-fair"
                                style="font-size: 3rem; font-weight: bold; color: var(--accent-color); text-shadow: 0 0 20px rgba(50,250,150,0.3);">
                                ---</div>
                            <div id="val-status"
                                style="margin-top: 1rem; font-size: 1rem; padding: 0.4rem 1rem; border-radius: 20px; background: rgba(255,255,255,0.1);">
                                ---</div>

                            <div
                                style="margin-top: 2rem; width: 100%; height: 10px; background: #333; border-radius: 5px; position: relative; overflow: hidden;">
                                <div id="val-meter"
                                    style="width: 50%; height: 100%; background: linear-gradient(90deg, #ef4444 0%, #fbbf24 50%, #22c55e 100%); transition: width 1s;">
                                </div>
                            </div>
                            <div
                                style="display:flex; justify-content:space-between; width:100%; margin-top:0.5rem; font-size:0.8rem; color:#666;">
                                <span>Undervalued</span>
                                <span>Overvalued</span>
                            </div>
                        </div>
                    </div>

                    <!-- Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="stat-box"
                            style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px;">
                            <span class="stat-label" data-i18n="fund_pe"
                                style="display:block; color:var(--text-secondary); margin-bottom:0.5rem;">P/E</span>
                            <span class="stat-value" id="val-pe" style="font-size:1.5rem; font-weight:bold;">---</span>
                        </div>
                        <div class="stat-box"
                            style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px;">
                            <span class="stat-label" data-i18n="fund_eps"
                                style="display:block; color:var(--text-secondary); margin-bottom:0.5rem;">EPS</span>
                            <span class="stat-value" id="val-eps" style="font-size:1.5rem; font-weight:bold;">---</span>
                        </div>
                        <div class="stat-box"
                            style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px;">
                            <span class="stat-label" data-i18n="fund_pb"
                                style="display:block; color:var(--text-secondary); margin-bottom:0.5rem;">P/B</span>
                            <span class="stat-value" id="val-pb" style="font-size:1.5rem; font-weight:bold;">---</span>
                        </div>
                        <div class="stat-box"
                            style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px;">
                            <span class="stat-label" data-i18n="fund_roe"
                                style="display:block; color:var(--text-secondary); margin-bottom:0.5rem;">ROE</span>
                            <span class="stat-value" id="val-roe" style="font-size:1.5rem; font-weight:bold;">---</span>
                        </div>
                        <div class="stat-box"
                            style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px; grid-column: 1 / -1;">
                            <span class="stat-label" data-i18n="fund_debt_eq"
                                style="display:block; color:var(--text-secondary); margin-bottom:0.5rem;">Debt/Equity</span>
                            <span class="stat-value" id="val-de" style="font-size:1.5rem; font-weight:bold;">---</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Scorecard View -->
            <div id="technical-view" style="display:none; padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
                    <!-- Score Dial -->
                    <div class="card"
                        style="background: rgba(0,0,0,0.3); padding: 1.5rem; display:flex; flex-direction:column; align-items:center; justify-content:center; border: 1px solid var(--glass-border);">
                        <h3 style="margin-bottom:1rem; color:var(--text-secondary);">Technical Score</h3>
                        <div id="tech-score-circle"
                            style="width:120px; height:120px; border-radius:50%; border:10px solid #333; display:flex; align-items:center; justify-content:center; position:relative;">
                            <span id="tech-score-val" style="font-size:2.5rem; font-weight:bold;">--</span>
                        </div>
                        <div id="tech-sentiment"
                            style="margin-top:1rem; font-size:1.2rem; font-weight:bold; color:var(--text-secondary);">
                            Neutral</div>
                    </div>

                    <!-- Signals Table -->
                    <div class="card"
                        style="background: rgba(0,0,0,0.3); padding: 0; overflow:hidden; border: 1px solid var(--glass-border);">
                        <table style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr style="background:rgba(255,255,255,0.05); text-align:left;">
                                    <th style="padding:1rem;">Indicator</th>
                                    <th style="padding:1rem;">Value</th>
                                    <th style="padding:1rem;">Action</th>
                                    <th style="padding:1rem;">Description</th>
                                </tr>
                            </thead>
                            <tbody id="tech-signals-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="result-container" class="card">
            <div id="market-info" class="market-header" style="display: none;">
                <div>
                    <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                        <span id="tikz-symbol">SYMBOL</span>
                        <button id="btn-fav" class="star-btn" title="Add to Favorites"
                            style="background:none; border:none; cursor:pointer; font-size:1.5rem; color:var(--text-secondary);">
                            ‚òÜ
                        </button>
                    </h2>
                    <div class="symbol-sub">
                        <span id="tikz-change" class="change-display">0.00%</span>
                        <span class="live-badge">LIVE üü¢</span>
                    </div>
                </div>
                <div class="price-display">
                    <span id="tikz-price">0.00</span>
                    <span class="currency">USD/THB</span>
                </div>
            </div>

            <!-- Detailed Stats Grid -->
            <div id="stats-grid" class="stats-grid" style="display: none;">
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_open">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î</div>
                    <div id="stat-open" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_high">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                    <div id="stat-high" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_low">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</div>
                    <div id="stat-low" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label" data-i18n="stat_prev">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>
                    <div id="stat-prev" class="stat-value">0.00</div>
                </div>
            </div>

            <!-- Company Info & Holders -->
            <div id="company-section" class="company-grid" style="display: none;">
                <div class="company-card">
                    <h3>üè¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Company Profile)</h3>
                    <div class="profile-meta">
                        <span id="prof-sector" class="badge">Sector</span>
                        <span id="prof-industry" class="badge">Industry</span>
                    </div>
                    <p id="prof-summary" class="summary-text">...</p>
                </div>
                <div class="company-card">
                    <h3>üë• ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà (Major Shareholders)</h3>
                    <ul id="holders-list" class="holders-list">
                        <!-- Items injected here -->
                    </ul>
                </div>
            </div>

            <div id="result-output" class="markdown-body">
                <!-- Analysis will appear here -->
            </div>
            <!-- Investment Calculator (New) -->
            <div id="calculator-section" class="card" style="display: none; border-color: var(--warning-color);">
                <div
                    style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                    <h3 style="margin: 0;">üîÆ Investment Projector</h3>

                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div style="text-align: right;">
                            <label style="color: var(--text-secondary); font-size: 0.9rem; display:block;">Budget
                                (THB):</label>
                            <input type="number" id="calc-budget" value="10000"
                                style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; width: 120px; font-weight: bold;">
                        </div>

                        <div style="text-align: right;">
                            <label
                                style="color: var(--text-secondary); font-size: 0.9rem; display:block;">Duration:</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="number" id="calc-duration-val" value="1"
                                    style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; width: 60px; font-weight: bold; text-align: center;">
                                <select id="calc-duration-unit"
                                    style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; font-weight: bold;">
                                    <option value="days">Days</option>
                                    <option value="months">Months</option>
                                    <option value="years" selected>Years</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table style="margin-top: 0;">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Target Price</th>
                                <th>% Upside</th>
                                <th>Future Value</th>
                                <th>Profit/Loss</th>
                            </tr>
                        </thead>
                        <tbody id="calc-body">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <p style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin-top: 1rem;">
                    *Calculations based on Analyst Consensus Targets. Not financial advice.
                </p>
            </div>
            <div id="news-section" class="news-container" style="display: none;">
                <h3>üì∞ Latest News</h3>
                <div id="news-list" class="news-grid">
                    <!-- News items will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Backtest Settings Modal -->
    <div id="bt-modal" class="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; display:flex; align-items:center; justify-content:center;">
        <div class="modal-content"
            style="background:var(--card-bg); padding:2rem; border-radius:12px; width:90%; max-width:400px; border:1px solid var(--glass-border); position: relative;">
            <span id="close-bt-modal"
                style="position:absolute; top:1rem; right:1rem; cursor:pointer; font-size:1.5rem;">&times;</span>
            <h3 style="margin-bottom:1.5rem;">‚öôÔ∏è Strategy Config</h3>

            <div class="control-group" style="margin-bottom:1rem;">
                <label style="display:flex; justify-content:space-between;">
                    <span>RSI Buy (<span id="disp-rsi-buy">30</span>)</span>
                </label>
                <input type="range" id="in-rsi-buy" min="10" max="50" value="30" style="width:100%;">
            </div>

            <div class="control-group" style="margin-bottom:1rem;">
                <label style="display:flex; justify-content:space-between;">
                    <span>RSI Sell (<span id="disp-rsi-sell">70</span>)</span>
                </label>
                <input type="range" id="in-rsi-sell" min="50" max="90" value="70" style="width:100%;">
            </div>

            <div class="control-group" style="margin-bottom:2rem;">
                <label style="display:flex; justify-content:space-between;">
                    <span>Stop Loss (<span id="disp-sl">5</span>%)</span>
                </label>
                <input type="range" id="in-sl" min="1" max="20" value="5" style="width:100%;">
            </div>

            <button id="btn-start-bt"
                style="width:100%; padding:0.8rem; background:var(--accent-color); color:black; border:none; font-weight:bold; cursor:pointer; border-radius:6px;">Run
                Backtest üöÄ</button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading" class="loading-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center;">
        <div class="spinner"
            style="border: 4px solid rgba(255, 255, 255, 0.3); width: 40px; height: 40px; border-radius: 50%; border-top-color: var(--accent-color); animation: spin 1s ease-in-out infinite;">
        </div>
    </div>

    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <script src="js/core/i18n.js"></script>
    <script src="js/core/watchlist.js"></script>
    <script src="js/core/analyst.js"></script>
    <script src="js/core/portfolio.js"></script>
    <script src="js/app.js"></script>
</body>

</html>