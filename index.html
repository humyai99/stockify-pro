<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockify Pro AI ü§ñ</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Outfit:wght@400;500;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">
        <header>
            <h1>Stockify Pro ü§ñ</h1>
            <div class="subtitle">AI-Powered Technical Analysis Assistant</div>
        </header>

        <style>
            /* Navbar Styles (Shared) */
            .nav-bar {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .nav-link {
                text-decoration: none;
                color: var(--text-secondary);
                font-weight: 600;
                padding: 0.5rem 1rem;
                border-radius: 8px;
                transition: all 0.2s;
            }

            .nav-link.active {
                background: var(--accent-color);
                color: white;
            }

            .nav-link:hover:not(.active) {
                background: var(--card-bg);
                color: var(--text-primary);
            }
        </style>

        <div class="nav-bar">
            <a href="index.html" class="nav-link active">üìä Analyzer</a>
            <a href="screener.html" class="nav-link">üîç Screener</a>
            <a href="portfolio.html" class="nav-link">üíº Portfolio</a>
        </div>

        <div class="card">
            <div class="search-container">
                <form id="search-form" class="search-box">
                    <input type="text" id="symbol-input" placeholder="üîç Search Symbol (e.g. AAPL, PTT.BK)" required>
                    <button type="submit">Analyze</button>
                </form>
                <div class="search-tips">
                    Tips: Use suffix <strong>.BK</strong> for Thai stocks (e.g., <em>SCB.BK</em>).
                </div>
            </div>

            <!-- Discovery Dashboard (New) -->
            <div id="discovery-section" style="margin-top: 2rem; display: none;">
                <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    üß≠ AI Market Discovery <span
                        style="font-size: 0.8rem; font-weight: normal; color: var(--text-secondary);">(Top
                        Opportunities)</span>
                </h3>
                <div id="discovery-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    <!-- Cards will be injected here -->
                    <div style="grid-column: 1/-1; text-align: center; color: var(--text-secondary);">
                        Scanning Markets... üì°
                    </div>
                </div>
            </div>
        </div>

        <div id="loading-spinner" class="spinner" style="display: none;">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>

        <!-- Trading Panel (New) -->
        <div id="trading-panel" class="card"
            style="display: none; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-color);">
            <div class="trading-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin:0;">üíº Paper Trading</h3>
                <div class="balance-display">
                    üíµ Balance: <span id="wallet-balance" style="font-weight:bold; color:#22c55e;">0.00</span>
                </div>
            </div>

            <div class="trade-controls" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div class="form-group" style="flex: 1;">
                    <label>Action</label>
                    <select id="trade-action">
                        <option value="BUY">üü¢ BUY (Long)</option>
                        <option value="SELL">üî¥ SELL (Short/Close)</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Quantity</label>
                    <input type="number" id="trade-qty" value="100" min="1">
                </div>
                <button id="btn-execute-trade" class="btn-primary" style="flex: 1; margin: 0; padding: 0.75rem;">
                    Submit Order üöÄ
                </button>
            </div>
            <div id="trade-feedback" style="margin-top: 1rem; text-align: center; font-weight: bold;"></div>
        </div>

        <!-- Chart Container -->
        <div id="chart-card" class="card" style="display: none; height: 500px; padding: 1rem; position: relative;">
            <div style="position: absolute; top: 1rem; right: 1rem; z-index: 10;">
                <button id="btn-run-backtest" class="btn-primary"
                    style="margin: 0; padding: 0.5rem 1rem; font-size: 0.9rem; background: rgba(30, 41, 59, 0.8); border: 1px solid var(--border-color);">
                    Run Backtest üîô
                </button>
            </div>
            <div id="backtest-overlay"
                style="display: none; position: absolute; top: 4rem; right: 1rem; background: rgba(15, 23, 42, 0.95); border: 1px solid var(--accent-color); padding: 1rem; border-radius: 8px; z-index: 10; width: 250px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <h4 style="margin: 0 0 0.5rem 0; color: var(--accent-color);">Backtest (1 Year)</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
                    <div style="color: var(--text-secondary);">Return:</div>
                    <div id="bt-return" style="font-weight: bold;">...</div>
                    <div style="color: var(--text-secondary);">Win Rate:</div>
                    <div id="bt-winrate" style="font-weight: bold;">...</div>
                    <div style="color: var(--text-secondary);">Trades:</div>
                    <div id="bt-trades" style="font-weight: bold;">...</div>
                </div>
            </div>
            <div id="chart-container" style="width: 100%; height: 100%;"></div>
        </div>

        <div id="result-container" class="card">
            <div id="market-info" class="market-header" style="display: none;">
                <div>
                    <h2 id="tikz-symbol">SYMBOL</h2>
                    <div class="symbol-sub">
                        <span id="tikz-change" class="change-display">0.00%</span>
                        <span class="live-badge">LIVE üü¢</span>
                    </div>
                </div>
                <div class="price-display">
                    <span id="tikz-price">0.00</span>
                    <span class="currency">USD/THB</span>
                </div>
            </div>

            <!-- Detailed Stats Grid -->
            <div id="stats-grid" class="stats-grid" style="display: none;">
                <div class="stat-item">
                    <div class="stat-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î</div>
                    <div id="stat-open" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                    <div id="stat-high" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</div>
                    <div id="stat-low" class="stat-value">0.00</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏î‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>
                    <div id="stat-prev" class="stat-value">0.00</div>
                </div>
            </div>

            <!-- Company Info & Holders -->
            <div id="company-section" class="company-grid" style="display: none;">
                <div class="company-card">
                    <h3>üè¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (Company Profile)</h3>
                    <div class="profile-meta">
                        <span id="prof-sector" class="badge">Sector</span>
                        <span id="prof-industry" class="badge">Industry</span>
                    </div>
                    <p id="prof-summary" class="summary-text">...</p>
                </div>
                <div class="company-card">
                    <h3>üë• ‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏£‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà (Major Shareholders)</h3>
                    <ul id="holders-list" class="holders-list">
                        <!-- Items injected here -->
                    </ul>
                </div>
            </div>

            <div id="result-output" class="markdown-body">
                <!-- Analysis will appear here -->
            </div>
            <!-- Investment Calculator (New) -->
            <div id="calculator-section" class="card" style="display: none; border-color: var(--warning-color);">
                <div
                    style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; gap: 1rem;">
                    <h3 style="margin: 0;">üîÆ Investment Projector</h3>

                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div style="text-align: right;">
                            <label style="color: var(--text-secondary); font-size: 0.9rem; display:block;">Budget
                                (THB):</label>
                            <input type="number" id="calc-budget" value="10000"
                                style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; width: 120px; font-weight: bold;">
                        </div>

                        <div style="text-align: right;">
                            <label
                                style="color: var(--text-secondary); font-size: 0.9rem; display:block;">Duration:</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="number" id="calc-duration-val" value="1"
                                    style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; width: 60px; font-weight: bold; text-align: center;">
                                <select id="calc-duration-unit"
                                    style="padding: 0.5rem; border-radius: 8px; border: 1px solid var(--glass-border); background: rgba(0,0,0,0.2); color: white; font-weight: bold;">
                                    <option value="days">Days</option>
                                    <option value="months">Months</option>
                                    <option value="years" selected>Years</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="screener-table" style="margin-top: 0;">
                        <thead>
                            <tr>
                                <th>Scenario</th>
                                <th>Target Price</th>
                                <th>% Upside</th>
                                <th>Future Value</th>
                                <th>Profit/Loss</th>
                            </tr>
                        </thead>
                        <tbody id="calc-body">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <p style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin-top: 1rem;">
                    *Calculations based on Analyst Consensus Targets. Not financial advice.
                </p>
            </div>
            <div id="news-section" class="news-container" style="display: none;">
                <h3>üì∞ Latest News</h3>
                <div id="news-list" class="news-grid">
                    <!-- News items will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <script src="js/core/analyst.js"></script>
    <script src="js/core/portfolio.js"></script>
    <script src="js/app.js"></script>
</body>

</html>